<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Youtube popup with Jquery</title>
    
    <script type="text/javascript" src="http://jquery.com/src/jquery-latest.pack.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi" ></script>
    <script type="text/javascript" src="js/swfobject.js" ></script>
    <script type="text/javascript" src="http://happylucky.googlecode.com/svn-history/r19/trunk/common/script/jquery-ui-1.8.14.custom.min.js"></script>
    <script src="http://static.firebase.com/v0/firebase.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="resources/styles/styles.css"  />
    
    <script type="text/javascript">
    
    	var firemonk9Ref = null; var roomId="234568";
    	var messageText = "", videoID=0, videoStatus = "none", currenttime = 0;
    	
    	firemonk9Ref_roomId = new Firebase('http://gamma.firebase.com/Firemonk9/'+roomId);
    
		//Common functions for both players.
		function loadpopup(objid){
			resetAllFields();
			$("#simplePopUpWindow").draggable();
			$("#chromeLessPopUpWindow").draggable();
			$("#"+objid).center();
			$("#backgroundPopup").css({  
		  				"opacity": "0.7"  
		  		});  
		  	$("#backgroundPopup").fadeIn("slow");
		  	$("#"+objid).fadeIn("fast");
			$("#youtubeurl").focus();
		  	if(objid=='chromeLessPopUpWindow'){
		  		loadChromeLessPlayer();
		  	}
		}
      
		function disablePopup(obj){ 
			swfobject.removeSWF("simpleytPlayer");
			swfobject.removeSWF("chromeLessytPlayer");
			$("#progressbar").remove();
			var objid = $(obj).parent('div').parent('div').attr('id'); $("#"+objid).fadeOut("fast"); 
			$("#backgroundPopup").fadeOut("slow");  
			//$("#chromeLessPopUpWindow").fadeOut("fast"); $("#simplePopUpWindow").fadeOut("fast");
		} 
		
		 jQuery.fn.center = function () {
	    	    this.css("position","absolute");
	    	    this.css("top", (($(window).height() - this.outerHeight()) / 2) +  $(window).scrollTop() + "px");
	    	    this.css("left", (($(window).width() - this.outerWidth()) / 2) +  $(window).scrollLeft() + "px");
	    	    return this;
	     }
		
		 function resetAllFields(){
			 $("#youtubeurl").val("");
			 swfobject.removeSWF("simpleytPlayer");
			 $("#infodiv").show();  $("#errordiv").hide();
		 }
		 
		 function youtube_parser(url){
			    var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
			    var match = url.match(regExp);
			    if (match&&match[7].length==11){
			        return match[7];
			    }else{
			        $("#infodiv").show();
			        $("#errordiv").show();
			        return 0;
			    }
		 }
		 
		  //This function is automatically called by the player once it loads
	     function onYouTubePlayerReady(playerId) {
	    	if ($('#chromeLessPopUpWindow:visible').length > 0){
	    		$("#chromeLessPopUpWindow").append('<div id="progressbar" />');
		        ytplayer = document.getElementById("chromeLessytPlayer");
		        setInterval(updateytplayerProgressBar, 250);
		        updateytplayerProgressBar();
		        //ytplayer.addEventListener("onStateChange", "onPlayerStateChange");
		        //ytplayer.addEventListener("onError", "onPlayerError");
		        ytplayer.cueVideoById(videoID);
			}else if($('#simplePopUpWindow:visible').length > 0){
			    simpleytPlayer = document.getElementById("simpleytPlayer"); 
			    if(simpleytPlayer){ 
			    	simpleytPlayer.addEventListener( "onStateChange", "handlePlayerStateChange" ); 
			    } 
	        }
		 }
	
		  
		//Functions for Simple Youtube Player (Moderator)
		function loadSimpleYTPlayer() {
			$("#infodiv").hide();  $("#errordiv").hide();
			swfobject.removeSWF("simpleytPlayer");
			var youtubeUrl = $("#youtubeurl").val();
			videoID = youtube_parser(youtubeUrl);
			if(videoID!=0 && videoID!=null){
				$("#youtubeUrlDiv").slideToggle("fast");
				$("#simplePopUpWindow").append('<div id="simplevideoDiv"/>');
				var params = { allowScriptAccess: "always" };
				var atts = { id: "simpleytPlayer" };
				swfobject.embedSWF("http://www.youtube.com/v/" + videoID + "?listType=search&version=3&enablejsapi=1&playerapiid=player1", 
		                      "simplevideoDiv", "480", "295", "9", null, null, params, atts);
			}
		}
		
		function handlePlayerStateChange(state) {
	    	 currenttime = simpleytPlayer.getCurrentTime();
	    	 if(state == -1){
	    		 videoStatus = "load"; //unstarted
	    	 }else if(state == 1){
	    		 videoStatus = "play";
	    	 }else if(state == 2){
	    		 videoStatus = "pause";
	    	 }else if(state == 0){
	    		 videoStatus = "end";
	    	 }
	    	 //else if(state == 3){
	    		// videoStatus = "buffer"; 
	    	// }
	    	 messageText = videoID +"&"+videoStatus+"&"+currenttime;
			 firemonk9Ref_roomId.push({msg:messageText});
	     }
		
		//-----------------------------------------------------------------------
		//Functions for Chromeless Youtube Player 
		firemonk9Ref_roomId.on('child_added', function(snapshot) {
			  if(snapshot.val() === null) {
			   		alert('User firemonk9Ref_roomId does not exist.');
			  }else {
				    var msgReceived = snapshot.val().msg;
				    var msgArray = msgReceived.split("&");
				    videoID = msgArray[0];
				    videoStatus = msgArray[1];
				    currenttime = msgArray[2];
				    
				    if($('#simplePopUpWindow:visible').length<=0){
				    	if(videoStatus == "load"){
					    	loadpopup('chromeLessPopUpWindow');
					    }else if(videoStatus == "play"){
					    	playVideo(currenttime);
					    }else if(videoStatus == "pause"){
					    	pauseVideo();
					    }else if(videoStatus == "end"){
					    	ytplayer.stopVideo();
					    }
				    }
			  }
		});
		
	  function loadChromeLessPlayer() {
			swfobject.removeSWF("chromeLessytPlayer");
			$("#progressbar").remove();
			$("#chromeLessPopUpWindow").append('<div id="videoDiv"/>');
	        var params = { allowScriptAccess: "always" };
	        var atts = { id: "chromeLessytPlayer" };
	        swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3&enablejsapi=1&playerapiid=player1",
                           "videoDiv", "480", "295", "9", null, null, params, atts);
      }
			
      function updateytplayerProgressBar() {
    	  if(ytplayer && ytplayer.getDuration) {
	    	  var val= ytplayer.getCurrentTime();
	    	  var val2 = ytplayer.getDuration();
	    	  var val3 = val/val2*100;
	    	  $("#progressbar").progressbar({ value: val3});
    	  }
      }
      
      function playVideo(currenttime) {
        if (ytplayer) {
          ytplayer.seekTo(currenttime,true);
          ytplayer.playVideo();
        }
      }
      
      function pauseVideo() {
        if (ytplayer) {
          ytplayer.pauseVideo();
        }
      }
      
      function toggleSearchDiv(){
    	  $("#youtubeUrlDiv").slideToggle("fast");
      }
	      
    </script>
    
 </head>
  
  
 <body style="font-family: Arial;border: 0 none;">
 
    <div id="backgroundPopup" class="backgroundfade"></div>
    <input type="button" value="Open Simplepopup !" onclick="loadpopup('simplePopUpWindow')"/> </br>
    
    <div id="simplePopUpWindow" style="display:none" class="youtubePopup">
    	<div id="showHideImgdiv">
    		<a href="" onclick="toggleSearchDiv();return false;"  style="display:block;float:left;margin-left:10px;">
					<img src="resources/images/right.png" alt="show/hide" /></a>
		</div>
    	<div class="close">
			<a href="" onclick="disablePopup(this);return false;" style="display:block;float:right;margin-right:10px;">
					<img src="images/pop-close-btn.png" alt="close" /></a>
		</div>
   		<div id="youtubeUrlDiv">
   			<span><input type="text" class="input-box" id="youtubeurl" value="Enter URL here" onFocus='this.value="";' /></span>
   			<span><input type="button" value="Load Video" onclick="loadSimpleYTPlayer()"/></span>
   		</div>
   		<div id="errordiv" class="errortext-msg" style="display:none">Invalid Url.</div>
   		<div id="infodiv" class="pop-form1 infodiv2" width="100%" height="100%">
			<div class="help-tabs ahelp-tabs" style="height:260px;" id="ht1">
				<div class="icon-share">
					<img src="images/ss.png" alt="audio" width="130" height="85" >
				</div>
				<div class="text-heading">To share video, please enter valid youtube Url.
				And click on The "Load Video" button. </div>
			</div>
		</div>
    </div>
    
    <div id="chromeLessPopUpWindow" style="display:none" class="youtubePopup">
    	<div class="close">
			<a href="" onclick="disablePopup(this);return false;" style="display:block;float:right;margin-right:10px;">
					<img src="images/pop-close-btn.png" alt="close"></a>
		</div>
    </div>
      
  </body>
</html>